"use strict";(self.webpackChunkcgmh_ctc_website=self.webpackChunkcgmh_ctc_website||[]).push([[158],{4158:(tt,A,e)=>{e.r(A),e.d(A,{AdminModule:()=>_});var u=e(6895),f=e(2761),S=e(7618),$=e(9041),D=e(9602),m=e(6425),T=e(309),R=e(3086),U=e(8666),g=e(7579),h=e(2722),I=e(3900),d=e(4004),x=e(9841),C=e(8505),w=e(8675),E=e(8372),J=e(1884),y=e(515),Z=e(8746),L=e(262),F=e(7482),O=e(9577),Q=e(6415),t=e(4650),N=e(2225),Y=e(4367),b=e(315),M=e(7331),B=e(1572),j=e(682),H=e(901),z=e(9628);function P(n,r){1&n&&(t.TgZ(0,"mat-chip",18),t._uU(1,"\u7a7a\u9593\u9810\u7d04"),t.qZA())}function G(n,r){1&n&&(t.TgZ(0,"mat-chip",19),t._uU(1,"\u8ab2\u7a0b\u5831\u540d"),t.qZA())}function K(n,r){if(1&n&&(t.TgZ(0,"li",11)(1,"div",12),t._UZ(2,"app-datetime-span",13),t.qZA(),t.TgZ(3,"div",14),t._uU(4),t.qZA(),t.TgZ(5,"mat-chip-list",15),t.YNc(6,P,2,0,"mat-chip",16),t.YNc(7,G,2,0,"mat-chip",17),t.qZA()()),2&n){const s=r.$implicit;t.xp6(2),t.Q6J("start",s.startDatetime)("end",s.endDatetime),t.xp6(2),t.hij(" ",s.name," "),t.xp6(1),t.Q6J("selectable",!1),t.xp6(1),t.Q6J("ngIf","rsvn"===s.type),t.xp6(1),t.Q6J("ngIf","appl"===s.type)}}function W(n,r){1&n&&(t.TgZ(0,"li",20),t._uU(1," \u67e5\u7121\u5831\u540d\u6216\u9810\u7d04 "),t.qZA())}function X(n,r){1&n&&(t.TgZ(0,"div",21),t._UZ(1,"mat-spinner"),t.qZA())}const V=[{path:"",component:(()=>{class n{constructor(s,a,i,o){this.route=s,this.coursesService=a,this.resourcesService=i,this.snackBarService=o,this.destroy$=new g.x,this.viewInit$=new g.x,this.calendarHeader=F.$,this.now=new Date,this.selectedDate=null,this.yearAndMonth$=new g.x,this.dateFilter=c=>!1,this.dateClass=(c,p)=>"month"!==p?"":this.startDateSet.has((0,m.Z)(c,"yyyy/MM/dd"))?"bg-warn font-medium border-2 border-solid border-white rounded-full":"",this.eventList$=new g.x,this.startDateSet=new Set,this.gettingApplList=!1,this.gettingRsvnList=!1;const{resourceList:v}=this.route.snapshot.data;this.resourceNameMap=(0,Q.J)(v,"seq","name"),this.yearAndMonth$.pipe((0,h.R)(this.destroy$),(0,I.w)(c=>this.fetchEventList(c)),(0,d.U)(c=>{this.eventList$.next(c)})).subscribe(),(0,x.a)([this.viewInit$,this.eventList$]).pipe((0,h.R)(this.destroy$),(0,d.U)(([c,p])=>new Set(p.map(l=>(0,m.Z)(new Date(l.startDatetime),"yyyy/MM/dd")))),(0,C.b)(c=>{this.startDateSet=c,this.calendar.updateTodaysDate()})).subscribe()}ngOnInit(){}ngAfterViewInit(){this.viewInit$.next(null),this.viewInit$.complete(),this.calendar.stateChanges.pipe((0,h.R)(this.destroy$),(0,w.O)(null),(0,E.b)(300),(0,d.U)(()=>(0,m.Z)(this.calendar.activeDate,"yyyy/MM")),(0,J.x)(),(0,C.b)(s=>{this.yearAndMonth$.next(s)})).subscribe()}fetchEventList(s){const a=(0,T.Z)(`${s}/01`,"yyyy/MM/dd",new Date),i=(0,R.Z)((0,U.Z)(a,{months:1}),{days:1}),o=(0,m.Z)(a,"yyyy/MM/dd"),v=(0,m.Z)(i,"yyyy/MM/dd");return(0,x.a)([this.fetchApplList(o,v),this.fetchRsvnList(o,v)]).pipe((0,d.U)(([c,p])=>[...c.map(l=>({seq:l.seq,startDatetime:l.startDatetime,endDatetime:l.endDatetime,name:l.courseName,type:"appl"})),...p.map(l=>({seq:l.seq,startDatetime:l.startDatetime,endDatetime:l.endDatetime,name:this.resourceNameMap[""+l.resourceSeq],type:"rsvn"}))]),(0,d.U)(c=>c.sort((p,l)=>new Date(p.startDatetime).valueOf()-new Date(l.startDatetime).valueOf())))}fetchApplList(s,a){return this.gettingApplList?y.E:(this.gettingApplList=!0,this.coursesService.GetAccountApplList({minStartDate:s,maxStartDate:a}).pipe((0,h.R)(this.destroy$),(0,Z.x)(()=>this.gettingApplList=!1),(0,d.U)(o=>o.content),(0,L.K)(o=>this.onError(o))))}fetchRsvnList(s,a){return this.gettingRsvnList?y.E:(this.gettingRsvnList=!0,this.resourcesService.GetAccountRsvnList({minStartDate:s,maxStartDate:a}).pipe((0,h.R)(this.destroy$),(0,Z.x)(()=>this.gettingRsvnList=!1),(0,d.U)(o=>o.content),(0,L.K)(o=>this.onError(o))))}onError(s){return console.error(s),this.snackBarService.add({message:s.message,type:O.K.Error}),y.E}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return n.\u0275fac=function(s){return new(s||n)(t.Y36(f.gz),t.Y36(N.W),t.Y36(Y.X),t.Y36(b.c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-account"]],viewQuery:function(s,a){if(1&s&&t.Gf(D._H,5),2&s){let i;t.iGM(i=t.CRH())&&(a.calendar=i.first)}},decls:13,vars:11,consts:[["title","\u6703\u54e1\u5c08\u5340","engTitle","Account"],["id","account-section",1,"spinner-box","p-page-padding"],[1,"w-page","flex","flex-wrap","items-start"],[1,"w-full","shrink-0","flex","justify-center","mb-4","md:w-80","md:mr-8","md:mb-0","lg:w-120"],[1,"w-120","max-w-full","m-auto"],[3,"headerComponent","dateFilter","dateClass","selected","selectedChange"],[1,"w-full","grow","md:w-auto"],[1,"grid","grid-cols-1","gap-8","mb-8"],["class","col-span-1 bg-white rounded-lg shadow-lg p-4 cursor-pointer hover:bg-primary-300 hover:bg-opacity-10 hover:-translate-x-[2px] hover:-translate-y-[2px]",4,"ngFor","ngForOf"],["class","col-span-1 h-40 flex justify-center items-center",4,"ngIf"],["class","spinner",4,"ngIf"],[1,"col-span-1","bg-white","rounded-lg","shadow-lg","p-4","cursor-pointer","hover:bg-primary-300","hover:bg-opacity-10","hover:-translate-x-[2px]","hover:-translate-y-[2px]"],[1,"font-medium","text-sm","mb-2"],[3,"start","end"],[1,"h-12","text-base","line-clamp-2","mb-2"],[3,"selectable"],["class","bg-accent text-white","appStopClickPropagation","",4,"ngIf"],["class","bg-primary text-white","appStopClickPropagation","",4,"ngIf"],["appStopClickPropagation","",1,"bg-accent","text-white"],["appStopClickPropagation","",1,"bg-primary","text-white"],[1,"col-span-1","h-40","flex","justify-center","items-center"],[1,"spinner"]],template:function(s,a){if(1&s&&(t._UZ(0,"app-page-cover",0),t.TgZ(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-calendar",5),t.NdJ("selectedChange",function(o){return a.selectedDate=o}),t.qZA()()(),t.TgZ(6,"div",6)(7,"ul",7),t.YNc(8,K,8,6,"li",8),t.ALo(9,"async"),t.YNc(10,W,2,0,"li",9),t.ALo(11,"async"),t.qZA()()(),t.YNc(12,X,2,0,"div",10),t.qZA()),2&s){let i;t.xp6(5),t.Q6J("headerComponent",a.calendarHeader)("dateFilter",a.dateFilter)("dateClass",a.dateClass)("selected",a.selectedDate),t.xp6(3),t.Q6J("ngForOf",t.lcZ(9,7,a.eventList$)),t.xp6(2),t.Q6J("ngIf",!(a.gettingApplList||a.gettingRsvnList||null!=(i=t.lcZ(11,9,a.eventList$))&&i.length)),t.xp6(2),t.Q6J("ngIf",a.gettingApplList||a.gettingRsvnList)}},dependencies:[u.sg,u.O5,M.qn,M.HS,D._H,B.Ou,j.P,H._,z.M,u.Ov]}),n})(),pathMatch:"full",canActivate:[S.a],resolve:{resourceList:$.L}}];let q=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.Bz.forChild(V),f.Bz]}),n})();var k=e(1910);let _=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,q,k.m]}),n})()}}]);