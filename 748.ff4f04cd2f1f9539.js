"use strict";(self.webpackChunkcgmh_ctc_website=self.webpackChunkcgmh_ctc_website||[]).push([[748],{748:(vt,b,a)=>{a.r(b),a.d(b,{AdminModule:()=>ft});var d=a(6895),Z=a(2761),E=a(7618),J=a(9041),T=a(9602),g=a(6425),Y=a(309),w=a(3086),N=a(8666),D=a(7579),m=a(2722),O=a(3900),u=a(4004),$=a(9841),f=a(8505),Q=a(8675),F=a(8372),B=a(1884),A=a(515),C=a(8746),x=a(262),H=a(7482),L=a(9577),P=a(6415),v=a(5412),G=a(4960),j=a(4718),z=a(1135),t=a(4650),K=a(3306),M=a(2225),W=a(629),I=a(315),V=a(4859),U=a(1572),X=a(5940);function q(n,o){1&n&&(t.ynx(0),t.TgZ(1,"div",5)(2,"div",6)(3,"div",7),t._UZ(4,"mat-spinner"),t.qZA()()(),t.BQk())}function k(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td",13),t._uU(2),t.qZA(),t.TgZ(3,"td",14),t._uU(4),t.qZA()()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",e.label," "),t.xp6(2),t.Oqu(e.text)}}function _(n,o){if(1&n&&(t.ynx(0),t.YNc(1,k,5,2,"tr",8),t.BQk()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",e.text)}}function tt(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"h1",9),t._uU(2),t.qZA(),t.TgZ(3,"div",5)(4,"table",10),t.YNc(5,_,2,1,"ng-container",11),t.qZA(),t._UZ(6,"div",12),t.ALo(7,"safeHTML"),t.qZA(),t.BQk()),2&n){const e=o.ngIf,i=t.oxw(2);t.xp6(2),t.Oqu(e.name),t.xp6(3),t.Q6J("ngForOf",i.infoList),t.xp6(1),t.Q6J("innerHTML",t.lcZ(7,3,e.htmlContent),t.oJD)}}function et(n,o){if(1&n&&(t.YNc(0,tt,8,5,"ng-container",8),t.ALo(1,"async")),2&n){const e=t.oxw();t.Q6J("ngIf",t.lcZ(1,1,e.course$))}}let nt=(()=>{class n{constructor(e,i,s,l,p,h,r,c){this.data=e,this.dialogRef=i,this.currencyPipe=s,this.decimalPipe=l,this.datePipe=p,this.coursesService=h,this.authService=r,this.snackBarService=c,this.destroy$=new D.x,this.course$=new z.X(void 0),this.infoList=[],this.getting=!1,this.canCancel=!1,this.cancelling=!1,this.cancelled=!1,this.dialogRef.updateSize("600px");const{courseGUID:y}=this.data;"string"==typeof y&&0!==y.length?this.course$.pipe((0,m.R)(this.destroy$),(0,f.b)(S=>{void 0!==S&&(this.infoList=this.getInfoList(S),this.canCancel=!this.data.applCancelled&&(0,G.Z)(new Date,new Date(S.startDatetime)))})).subscribe():this.dialogRef.close()}ngOnInit(){this.fetchCourse().subscribe()}fetchCourse(e){return void 0===e&&(e=this.data.courseGUID),this.getting=!0,this.coursesService.GetCourse({guid:e}).pipe((0,m.R)(this.destroy$),(0,C.x)(()=>this.getting=!1),(0,f.b)(s=>{const l=this.coursesService.extendCourse(s.content,this.authService.appliedCourseGUIDList$.getValue());this.course$.next(l)}),(0,x.K)(s=>(this.dialogRef.close(),this.onError(s))))}getInfoList(e){return[{label:"\u6642\u9593",text:this.getDatetimeSpan(e.startDatetime,e.endDatetime)},{label:"\u5730\u9ede",text:e.location},{label:"\u4e3b\u8fa6\u55ae\u4f4d",text:e.organizer},{label:"\u806f\u7d61\u96fb\u8a71",text:e.organizerTelNo},{label:"\u806f\u7d61\u4fe1\u7bb1",text:e.organizerEmail},{label:"\u5831\u540d\u6642\u9593",text:this.getDatetimeSpan(e.applyStartDatetime,e.applyEndDatetime)},{label:"\u8cbb\u7528",text:e.charge?this.currencyPipe.transform(e.charge,"TWD","symbol","1.0-2"):"\u514d\u8cbb"},{label:"\u540d\u984d\u9650\u5236",text:e.quotaLimit?`${this.decimalPipe.transform(e.quotaLimit,"1.0-0")} \u4eba`:"\u7121\u9650\u5236"},{label:"\u5269\u9918\u540d\u984d",text:e.quotaLimit?`${this.decimalPipe.transform(e.quotaLimit-e.appliedCount,"1.0-0")} \u4eba`:void 0},{label:"\u627f\u8fa6\u4eba",text:e.contractor},{label:"\u627f\u8fa6\u4eba\u96fb\u8a71",text:e.contractorTelNo},{label:"\u627f\u8fa6\u4eba\u4fe1\u7bb1",text:e.contractorEmail}]}getDatetimeSpan(e,i){const s="yyyy-MM-dd (E) HH:mm",p=(0,j.Z)(new Date(e),new Date(i));return`${this.datePipe.transform(e,s)} ~ ${this.datePipe.transform(i,p?s:"HH:mm")}`}onCancelAppl(e){this.getting||this.cancelling||this.cancelled||(this.cancelling=!0,this.coursesService.CancelAppl({seq:e}).pipe((0,m.R)(this.destroy$),(0,C.x)(()=>this.cancelling=!1),(0,f.b)(s=>{this.snackBarService.add({message:s.message,type:L.K.Success}),this.cancelled=!0}),(0,x.K)(s=>this.onError(s))).subscribe())}closeDialog(){this.dialogRef.close(this.cancelled)}onError(e){return console.error(e),this.snackBarService.add({message:e.message,type:L.K.Error}),A.E}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(v.WI),t.Y36(v.so),t.Y36(d.H9),t.Y36(d.JJ),t.Y36(K.j),t.Y36(M.W),t.Y36(W.e),t.Y36(I.c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-course-appl-dialog"]],decls:8,vars:4,consts:[[4,"ngIf","ngIfElse"],["fulfilled",""],["mat-dialog-actions","","align","end"],["type","button","mat-button","",3,"click"],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],["mat-dialog-content",""],[1,"spinner-box"],[1,"spinner"],[4,"ngIf"],["mat-dialog-title",""],[1,"w-full","mb-8"],[4,"ngFor","ngForOf"],[1,"ck","ck-content",3,"innerHTML"],[1,"leading-6","text-sm","font-medium","align-top","whitespace-nowrap"],[1,"text-base","px-4"]],template:function(e,i){if(1&e&&(t.YNc(0,q,5,0,"ng-container",0),t.YNc(1,et,2,3,"ng-template",null,1,t.W1O),t.TgZ(3,"div",2)(4,"button",3),t.NdJ("click",function(){return i.closeDialog()}),t._uU(5,"\u95dc\u9589"),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return i.onCancelAppl(i.data.applSeq)}),t._uU(7),t.qZA()()),2&e){const s=t.MAs(2);t.Q6J("ngIf",i.getting)("ngIfElse",s),t.xp6(6),t.Q6J("disabled",!i.canCancel||i.cancelling||i.cancelled),t.xp6(1),t.hij(" ",i.data.applCancelled||i.cancelled?"\u5df2\u53d6\u6d88":"\u53d6\u6d88\u5831\u540d"," ")}},dependencies:[d.sg,d.O5,V.lW,v.uh,v.xY,v.H8,U.Ou,d.Ov,X.u]}),n})();var it=a(4367),R=a(7331),at=a(682),st=a(901),ot=a(9628);function lt(n,o){1&n&&(t.TgZ(0,"mat-chip",19),t._uU(1,"\u7a7a\u9593\u9810\u7d04"),t.qZA())}function ct(n,o){1&n&&(t.TgZ(0,"mat-chip",20),t._uU(1,"\u8ab2\u7a0b\u5831\u540d"),t.qZA())}function rt(n,o){1&n&&(t.TgZ(0,"mat-chip",21),t._uU(1,"\u5df2\u53d6\u6d88"),t.qZA())}function pt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"li",11),t.NdJ("click",function(){const l=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.onViewEvent(l))}),t.TgZ(1,"div",12),t._UZ(2,"app-datetime-span",13),t.qZA(),t.TgZ(3,"div",14),t._uU(4),t.qZA(),t.TgZ(5,"mat-chip-list",15),t.YNc(6,lt,2,0,"mat-chip",16),t.YNc(7,ct,2,0,"mat-chip",17),t.YNc(8,rt,2,0,"mat-chip",18),t.qZA()()}if(2&n){const e=o.$implicit;t.xp6(2),t.Q6J("start",e.startDatetime)("end",e.endDatetime),t.xp6(2),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("selectable",!1),t.xp6(1),t.Q6J("ngIf","rsvn"===e.type),t.xp6(1),t.Q6J("ngIf","appl"===e.type),t.xp6(1),t.Q6J("ngIf",e.cancelled)}}function dt(n,o){1&n&&(t.TgZ(0,"li",22),t._uU(1," \u67e5\u7121\u5831\u540d\u6216\u9810\u7d04 "),t.qZA())}function mt(n,o){1&n&&(t.TgZ(0,"div",23),t._UZ(1,"mat-spinner"),t.qZA())}const ut=[{path:"",component:(()=>{class n{constructor(e,i,s,l,p){this.route=e,this.matDialog=i,this.coursesService=s,this.resourcesService=l,this.snackBarService=p,this.destroy$=new D.x,this.viewInit$=new D.x,this.calendarHeader=H.$,this.now=new Date,this.selectedDate=null,this.yearAndMonth$=new D.x,this.dateFilter=r=>!1,this.dateClass=(r,c)=>"month"!==c?"":this.startDateSet.has((0,g.Z)(r,"yyyy/MM/dd"))?"bg-warn font-medium border-2 border-solid border-white rounded-full":"",this.eventList$=new D.x,this.startDateSet=new Set,this.gettingApplList=!1,this.gettingRsvnList=!1;const{resourceList:h}=this.route.snapshot.data;this.resourceNameMap=(0,P.J)(h,"seq","name"),this.yearAndMonth$.pipe((0,m.R)(this.destroy$),(0,O.w)(r=>this.fetchEventList(r)),(0,u.U)(r=>{this.eventList$.next(r)})).subscribe(),(0,$.a)([this.viewInit$,this.eventList$]).pipe((0,m.R)(this.destroy$),(0,u.U)(([r,c])=>new Set(c.filter(y=>!y.cancelled).map(y=>(0,g.Z)(new Date(y.startDatetime),"yyyy/MM/dd")))),(0,f.b)(r=>{this.startDateSet=r,this.calendar.updateTodaysDate()})).subscribe()}ngOnInit(){}ngAfterViewInit(){this.viewInit$.next(null),this.viewInit$.complete(),this.calendar.stateChanges.pipe((0,m.R)(this.destroy$),(0,Q.O)(null),(0,F.b)(300),(0,u.U)(()=>(0,g.Z)(this.calendar.activeDate,"yyyy/MM")),(0,B.x)(),(0,f.b)(e=>{this.yearAndMonth$.next(e)})).subscribe()}fetchEventList(e){const i=(0,Y.Z)(`${e}/01`,"yyyy/MM/dd",new Date),s=(0,w.Z)((0,N.Z)(i,{months:1}),{days:1}),l=(0,g.Z)(i,"yyyy/MM/dd"),p=(0,g.Z)(s,"yyyy/MM/dd");return(0,$.a)([this.fetchApplList(l,p),this.fetchRsvnList(l,p)]).pipe((0,u.U)(([h,r])=>[...h.map(c=>({seq:c.seq,startDatetime:c.startDatetime,endDatetime:c.endDatetime,name:c.courseName,cancelled:c.cancelled,type:"appl",courseGUID:c.courseGUID})),...r.map(c=>({seq:c.seq,startDatetime:c.startDatetime,endDatetime:c.endDatetime,name:this.resourceNameMap[""+c.resourceSeq],cancelled:c.cancelled,type:"rsvn"}))]),(0,u.U)(h=>h.sort((r,c)=>new Date(r.startDatetime).valueOf()-new Date(c.startDatetime).valueOf())))}fetchApplList(e,i){return this.gettingApplList?A.E:(this.gettingApplList=!0,this.coursesService.GetAccountApplList({minStartDate:e,maxStartDate:i}).pipe((0,m.R)(this.destroy$),(0,C.x)(()=>this.gettingApplList=!1),(0,u.U)(l=>l.content),(0,x.K)(l=>this.onError(l))))}fetchRsvnList(e,i){return this.gettingRsvnList?A.E:(this.gettingRsvnList=!0,this.resourcesService.GetAccountRsvnList({minStartDate:e,maxStartDate:i}).pipe((0,m.R)(this.destroy$),(0,C.x)(()=>this.gettingRsvnList=!1),(0,u.U)(l=>l.content),(0,x.K)(l=>this.onError(l))))}onViewEvent(e){"appl"===e.type&&this.openCourseApplDialog(e)}openCourseApplDialog(e){this.matDialog.open(nt,{data:{applSeq:e.seq,applCancelled:e.cancelled,courseGUID:e.courseGUID}}).afterClosed().pipe((0,m.R)(this.destroy$),(0,f.b)(s=>{!0===s&&this.yearAndMonth$.next((0,g.Z)(this.calendar.activeDate,"yyyy/MM"))})).subscribe()}openResourceRsvnDialog(){}onError(e){return console.error(e),this.snackBarService.add({message:e.message,type:L.K.Error}),A.E}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.gz),t.Y36(v.uw),t.Y36(M.W),t.Y36(it.X),t.Y36(I.c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-account"]],viewQuery:function(e,i){if(1&e&&t.Gf(T._H,5),2&e){let s;t.iGM(s=t.CRH())&&(i.calendar=s.first)}},decls:13,vars:11,consts:[["title","\u6703\u54e1\u5c08\u5340","engTitle","Account"],["id","account-section",1,"spinner-box","p-page-padding"],[1,"w-page","flex","flex-wrap","items-start"],[1,"w-full","shrink-0","flex","justify-center","mb-4","md:w-80","md:mr-8","md:mb-0","lg:w-120"],[1,"w-120","max-w-full","m-auto"],[3,"headerComponent","dateFilter","dateClass","selected","selectedChange"],[1,"w-full","grow","md:w-auto"],[1,"grid","grid-cols-1","gap-8","mb-8"],["class","col-span-1 bg-white rounded-lg shadow-lg p-4 cursor-pointer hover:bg-primary-300 hover:bg-opacity-10 hover:-translate-x-[2px] hover:-translate-y-[2px]",3,"click",4,"ngFor","ngForOf"],["class","col-span-1 h-40 flex justify-center items-center",4,"ngIf"],["class","spinner",4,"ngIf"],[1,"col-span-1","bg-white","rounded-lg","shadow-lg","p-4","cursor-pointer","hover:bg-primary-300","hover:bg-opacity-10","hover:-translate-x-[2px]","hover:-translate-y-[2px]",3,"click"],[1,"font-medium","text-sm","mb-2"],[3,"start","end"],[1,"h-12","text-base","line-clamp-2","mb-2"],[3,"selectable"],["class","bg-accent text-white","appStopClickPropagation","",4,"ngIf"],["class","bg-primary text-white","appStopClickPropagation","",4,"ngIf"],["appStopClickPropagation","",4,"ngIf"],["appStopClickPropagation","",1,"bg-accent","text-white"],["appStopClickPropagation","",1,"bg-primary","text-white"],["appStopClickPropagation",""],[1,"col-span-1","h-40","flex","justify-center","items-center"],[1,"spinner"]],template:function(e,i){if(1&e&&(t._UZ(0,"app-page-cover",0),t.TgZ(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-calendar",5),t.NdJ("selectedChange",function(l){return i.selectedDate=l}),t.qZA()()(),t.TgZ(6,"div",6)(7,"ul",7),t.YNc(8,pt,9,7,"li",8),t.ALo(9,"async"),t.YNc(10,dt,2,0,"li",9),t.ALo(11,"async"),t.qZA()()(),t.YNc(12,mt,2,0,"div",10),t.qZA()),2&e){let s;t.xp6(5),t.Q6J("headerComponent",i.calendarHeader)("dateFilter",i.dateFilter)("dateClass",i.dateClass)("selected",i.selectedDate),t.xp6(3),t.Q6J("ngForOf",t.lcZ(9,7,i.eventList$)),t.xp6(2),t.Q6J("ngIf",!(i.gettingApplList||i.gettingRsvnList||null!=(s=t.lcZ(11,9,i.eventList$))&&s.length)),t.xp6(2),t.Q6J("ngIf",i.gettingApplList||i.gettingRsvnList)}},dependencies:[d.sg,d.O5,R.qn,R.HS,T._H,U.Ou,at.P,st._,ot.M,d.Ov]}),n})(),pathMatch:"full",canActivate:[E.a],resolve:{resourceList:J.L}}];let ht=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[Z.Bz.forChild(ut),Z.Bz]}),n})();var gt=a(12);let ft=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,ht,gt.m]}),n})()}}]);